<!DOCTYPE html>
<html>
<head>
    <title>Test MiniApp API</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px; margin: 5px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
        input { padding: 5px; margin: 5px; width: 300px; }
    </style>
</head>
<body>
    <h1>Тест MiniApp API</h1>
    
    <h2>1. Создать игрока (POST)</h2>
    <input type="text" id="nickname" placeholder="Nickname" value="TestPlayer">
    <button onclick="createPlayer()">Создать игрока</button>
    <div id="createResult"></div>
    
    <h2>2. Обновить игрока (PUT)</h2>
    <input type="text" id="playerId" placeholder="Player ID">
    <input type="text" id="updateNickname" placeholder="New Nickname" value="UpdatedPlayer">
    <button onclick="updatePlayer()">Обновить игрока</button>
    <div id="updateResult"></div>
    
    <h2>3. Получить игрока (GET)</h2>
    <input type="text" id="getPlayerId" placeholder="Player ID">
    <button onclick="getPlayer()">Получить игрока</button>
    <div id="getResult"></div>
    
    <h2>4. Health Check</h2>
    <button onclick="healthCheck()">Проверить здоровье</button>
    <div id="healthResult"></div>

    <script>
        const BASE_URL = 'http://localhost:3001/miniapp';
        
        async function createPlayer() {
            const nickname = document.getElementById('nickname').value;
            const data = {
                Nickname: nickname,
                SavedDate: new Date().toISOString(),
                MessageSent: null,
                TreePartData: {
                    TreeIndex: 0,
                    Toys: []
                }
            };
            
            try {
                const response = await fetch(`${BASE_URL}/player`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                document.getElementById('createResult').innerHTML = 
                    `<pre>${JSON.stringify(result, null, 2)}</pre>`;
                if (result._id) {
                    document.getElementById('playerId').value = result._id;
                    document.getElementById('getPlayerId').value = result._id;
                }
            } catch (error) {
                document.getElementById('createResult').innerHTML = 
                    `<pre style="color: red;">Ошибка: ${error.message}</pre>`;
            }
        }
        
        async function updatePlayer() {
            const playerId = document.getElementById('playerId').value;
            const nickname = document.getElementById('updateNickname').value;
            const data = {
                Nickname: nickname,
                SavedDate: new Date().toISOString(),
                MessageSent: "Test message",
                TreePartData: {
                    TreeIndex: 1,
                    Toys: [
                        {
                            ShapeId: 1,
                            PatternId: 2,
                            FillColorId: 3,
                            PatternColorId: 4,
                            Position: { x: 10, y: 20 }
                        }
                    ]
                }
            };
            
            try {
                const response = await fetch(`${BASE_URL}/player/${playerId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                document.getElementById('updateResult').innerHTML = 
                    `<pre>${JSON.stringify(result, null, 2)}</pre>`;
            } catch (error) {
                document.getElementById('updateResult').innerHTML = 
                    `<pre style="color: red;">Ошибка: ${error.message}</pre>`;
            }
        }
        
        async function getPlayer() {
            const playerId = document.getElementById('getPlayerId').value;
            
            try {
                const response = await fetch(`${BASE_URL}/player/${playerId}`);
                const result = await response.json();
                document.getElementById('getResult').innerHTML = 
                    `<pre>${JSON.stringify(result, null, 2)}</pre>`;
            } catch (error) {
                document.getElementById('getResult').innerHTML = 
                    `<pre style="color: red;">Ошибка: ${error.message}</pre>`;
            }
        }
        
        async function healthCheck() {
            try {
                const response = await fetch(`${BASE_URL}/health`);
                const result = await response.json();
                document.getElementById('healthResult').innerHTML = 
                    `<pre>${JSON.stringify(result, null, 2)}</pre>`;
            } catch (error) {
                document.getElementById('healthResult').innerHTML = 
                    `<pre style="color: red;">Ошибка: ${error.message}</pre>`;
            }
        }
    </script>
</body>
</html>

